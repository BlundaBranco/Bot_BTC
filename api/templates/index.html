<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Trading Bot - Panel de Control</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü§ñ</text></svg>">

    <!-- Google Fonts (Inter & JetBrains Mono) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}">
</head>
<body>
    <div class="background-grid"></div>
    
    <div class="container">
        <!-- Header -->
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fab fa-bitcoin"></i>
                    </div>
                    <div>
                        <h1>BITCOIN TRADING BOT</h1>
                        <div class="subtitle">Sistema Aut√≥nomo de Trading ‚Ä¢ Powered by Binance API</div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="status-badge">
                        <div class="status-dot"></div>
                        SISTEMA ACTIVO
                    </div>
                    <div class="connection-status">
                        <i class="fas fa-wifi"></i>
                        <span id="connection-text">Conectado</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Top Section: Price & Primary Signal -->
        <div class="grid-main">
            <!-- Price Card -->
            <div class="card card-price">
                <div class="card-header">
                    <i class="fas fa-chart-line"></i> Precio de Mercado
                </div>
                <div class="price-display">
                    <div class="card-value" id="price">---.--</div>
                    <div class="price-change" id="price-change">
                        <i class="fas fa-arrow-up"></i>
                        <span>+0.00%</span>
                    </div>
                </div>
                <div class="card-sub">
                    <span id="symbol">BTC/USDT</span> ‚Ä¢ <span id="timeframe">15m</span>
                </div>
                <div class="price-info">
                    <div class="info-item">
                        <span class="info-label">Exchange:</span>
                        <span class="info-value">Binance</span>
                    </div>
                </div>
            </div>

            <!-- Signal Card (Wider) -->
            <div class="card card-signal">
                <div class="card-header">
                    <i class="fas fa-brain"></i> An√°lisis de Se√±al con IA
                </div>
                <div class="signal-container">
                    <div class="signal-badge" id="signal-badge">
                        <div class="signal-icon" id="signal-icon">
                            <i class="fas fa-sync-alt fa-spin"></i>
                        </div>
                        <div class="signal-content">
                            <div class="card-value" id="signal-text">INICIALIZANDO...</div>
                            <div class="signal-timestamp" id="signal-time">Esperando datos del mercado...</div>
                        </div>
                    </div>
                    <div class="signal-reason" id="signal-reason">
                        Analizando condiciones del mercado en tiempo real...
                    </div>
                </div>
            </div>
        </div>

        <!-- Technical Indicators Section -->
        <div class="section-title">
            <i class="fas fa-chart-bar"></i>
            <span>Indicadores T√©cnicos</span>
        </div>

        <div class="grid-indicators">
            <!-- RSI -->
            <div class="card card-indicator">
                <div class="indicator-header">
                    <div class="card-header">RSI (14)</div>
                    <div class="indicator-badge" id="rsi-badge">NEUTRAL</div>
                </div>
                <div class="indicator-main">
                    <div class="trend-value" id="rsi-val">--.--</div>
                    <div class="indicator-bar">
                        <div class="indicator-progress" id="rsi-progress" style="width: 50%"></div>
                    </div>
                </div>
                <div class="card-sub">
                    <span>Sobrecompra: >70</span>
                    <span>Sobreventa: <30</span>
                </div>
            </div>

            <!-- MACD -->
            <div class="card card-indicator">
                <div class="indicator-header">
                    <div class="card-header">MACD</div>
                    <div class="indicator-badge" id="macd-badge">---</div>
                </div>
                <div class="indicator-main">
                    <div class="trend-value" id="macd-val">--.--</div>
                    <div class="macd-histogram" id="macd-histogram">
                        <div class="histogram-bar"></div>
                    </div>
                </div>
                <div class="card-sub">Convergencia/Divergencia</div>
            </div>

            <!-- Trend Filter -->
            <div class="card card-indicator">
                <div class="indicator-header">
                    <div class="card-header">R√©gimen de Mercado</div>
                    <div class="indicator-badge" id="trend-badge">---</div>
                </div>
                <div class="indicator-main">
                    <div class="trend-value" id="trend-text">---</div>
                    <div class="trend-icon" id="trend-icon">
                        <i class="fas fa-minus"></i>
                    </div>
                </div>
                <div class="card-sub">Filtro EMA 200</div>
            </div>

            <!-- Volume -->
            <div class="card card-indicator">
                <div class="indicator-header">
                    <div class="card-header">Volumen</div>
                    <div class="indicator-badge" id="vol-badge">NORMAL</div>
                </div>
                <div class="indicator-main">
                    <div class="trend-value" id="vol-ratio">--.--x</div>
                    <div class="volume-bars" id="volume-bars">
                        <!-- Barras de volumen -->
                    </div>
                </div>
                <div class="card-sub" id="vol-status">Actividad Normal</div>
            </div>
        </div>

        <!-- Market Stats -->
        <div class="section-title">
            <i class="fas fa-chart-area"></i>
            <span>Estad√≠sticas del Mercado</span>
        </div>

        <div class="grid-stats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-arrow-up"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-label">M√°ximo 24h</div>
                    <div class="stat-value" id="high-24h">$--,---</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-arrow-down"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-label">M√≠nimo 24h</div>
                    <div class="stat-value" id="low-24h">$--,---</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Volumen 24h</div>
                    <div class="stat-value" id="volume-24h">--- BTC</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-label">Cambio 24h</div>
                    <div class="stat-value" id="change-24h">+0.00%</div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="footer-content">
                <div class="footer-left">
                    <div class="footer-logo">
                        <i class="fab fa-bitcoin"></i>
                        <span>BTC Trading Bot</span>
                    </div>
                    <p class="footer-tagline">Estrategia de seguimiento de tendencias ‚Ä¢ Gesti√≥n de riesgo inteligente</p>
                    <p class="footer-exchange">Conectado a <strong>Binance</strong> v√≠a API oficial</p>
                </div>
                
                <div class="footer-center">
                    <div class="footer-stat">
                        <i class="fas fa-clock"></i>
                        <div>
                            <div class="footer-label">√öltima Actualizaci√≥n</div>
                            <div class="footer-value" id="clock">--:--:-- UTC</div>
                        </div>
                    </div>
                </div>

                <div class="footer-right">
                    <a href="https://github.com/BlundaBranco/Bot_BTC" target="_blank" class="github-link">
                        <i class="fab fa-github"></i>
                        Ver C√≥digo Fuente
                    </a>
                </div>
            </div>
            <div class="footer-bottom">
                <p>¬© 2025 Bitcoin Trading Bot ‚Ä¢ Sistema automatizado con FastAPI & Binance API</p>
                <p class="footer-disclaimer">‚ö†Ô∏è Solo para fines educativos. El trading conlleva riesgos significativos.</p>
            </div>
        </footer>
    </div>

    <!-- Logic Script -->
    <script>
        // Actualizar reloj
        function updateClock() {
            const now = new Date();
            const timeString = now.toISOString().split('T')[1].split('.')[0];
            document.getElementById('clock').innerText = timeString + ' UTC';
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Fetch de datos
        async function fetchData() {
            try {
                const res = await fetch('/api/status');
                const data = await res.json();

                if (data.status === 'initializing') return;

                // 1. Precios y S√≠mbolos
                const priceEl = document.getElementById('price');
                const newPrice = parseFloat(data.price).toFixed(2);
                
                // Efecto visual si cambia el precio
                if (priceEl.innerText !== `$${newPrice}` && priceEl.innerText !== '---.--') {
                    priceEl.classList.remove('updating');
                    void priceEl.offsetWidth;
                    priceEl.classList.add('updating');
                }
                priceEl.innerText = `$${newPrice}`;
                

                // --- NUEVO C√ìDIGO PARA ESTAD√çSTICAS 24H ---
                if (data.market_stats) {
                    document.getElementById('high-24h').innerText = '$' + parseFloat(data.market_stats.high).toFixed(2);
                    document.getElementById('low-24h').innerText = '$' + parseFloat(data.market_stats.low).toFixed(2);
                    document.getElementById('volume-24h').innerText = parseFloat(data.market_stats.volume).toFixed(2) + ' BTC';
                    
                    const changeEl = document.getElementById('change-24h');
                    const changeVal = parseFloat(data.market_stats.change);
                    changeEl.innerText = (changeVal >= 0 ? '+' : '') + changeVal.toFixed(2) + '%';
                    
                    // Color verde o rojo seg√∫n el cambio
                    if (changeVal >= 0) {
                        changeEl.style.color = 'var(--success-color)';
                    } else {
                        changeEl.style.color = 'var(--danger-color)';
                    }
                }

                document.getElementById('symbol').innerText = data.symbol;
                document.getElementById('timeframe').innerText = data.timeframe;
                
                // 2. Se√±ales
                const signalText = document.getElementById('signal-text');
                const signalReason = document.getElementById('signal-reason');
                const signalBadge = document.getElementById('signal-badge');
                const signalIcon = document.getElementById('signal-icon');
                const signalTime = document.getElementById('signal-time');

                const now = new Date();
                signalTime.innerText = `Actualizado: ${now.toLocaleTimeString('es-ES')}`;

                if (data.last_signal === 'buy') {
                    signalText.innerText = "SE√ëAL DE COMPRA";
                    signalText.className = "card-value text-green";
                    signalBadge.className = "signal-badge buy-signal";
                    signalIcon.innerHTML = '<i class="fas fa-arrow-trend-up"></i>';
                } else if (data.last_signal === 'sell') {
                    signalText.innerText = "SE√ëAL DE VENTA";
                    signalText.className = "card-value text-red";
                    signalBadge.className = "signal-badge sell-signal";
                    signalIcon.innerHTML = '<i class="fas fa-arrow-trend-down"></i>';
                } else {
                    signalText.innerText = "ESCANEANDO";
                    signalText.className = "card-value";
                    signalBadge.className = "signal-badge neutral-signal";
                    signalIcon.innerHTML = '<i class="fas fa-radar"></i>';
                }
                signalReason.innerText = data.signal_reason || "Condiciones de mercado neutrales. Esperando configuraci√≥n √≥ptima...";

                // 3. Indicadores
                // RSI
                const rsi = parseFloat(data.indicators.rsi).toFixed(1);
                const rsiEl = document.getElementById('rsi-val');
                const rsiBadge = document.getElementById('rsi-badge');
                const rsiProgress = document.getElementById('rsi-progress');
                
                rsiEl.innerText = rsi;
                rsiProgress.style.width = `${Math.min(rsi, 100)}%`;
                
                if (rsi > 70) {
                    rsiEl.className = "trend-value text-red";
                    rsiBadge.innerText = "SOBRECOMPRA";
                    rsiBadge.className = "indicator-badge badge-danger";
                    rsiProgress.style.background = "var(--danger-color)";
                } else if (rsi < 30) {
                    rsiEl.className = "trend-value text-green";
                    rsiBadge.innerText = "SOBREVENTA";
                    rsiBadge.className = "indicator-badge badge-success";
                    rsiProgress.style.background = "var(--success-color)";
                } else {
                    rsiEl.className = "trend-value";
                    rsiBadge.innerText = "NEUTRAL";
                    rsiBadge.className = "indicator-badge badge-neutral";
                    rsiProgress.style.background = "var(--accent-color)";
                }

                // MACD
                const macdVal = parseFloat(data.indicators.macd).toFixed(4);
                document.getElementById('macd-val').innerText = macdVal;
                const macdBadge = document.getElementById('macd-badge');
                if (macdVal > 0) {
                    macdBadge.innerText = "ALCISTA";
                    macdBadge.className = "indicator-badge badge-success";
                } else {
                    macdBadge.innerText = "BAJISTA";
                    macdBadge.className = "indicator-badge badge-danger";
                }

                // Tendencia
                const trendEl = document.getElementById('trend-text');
                const trendBadge = document.getElementById('trend-badge');
                const trendIcon = document.getElementById('trend-icon');
                
                if (data.indicators.trend === 'uptrend') {
                    trendEl.innerText = "ALCISTA";
                    trendEl.className = "trend-value text-green";
                    trendBadge.innerText = "BULLISH";
                    trendBadge.className = "indicator-badge badge-success";
                    trendIcon.innerHTML = '<i class="fas fa-arrow-trend-up"></i>';
                } else {
                    trendEl.innerText = "BAJISTA";
                    trendEl.className = "trend-value text-red";
                    trendBadge.innerText = "BEARISH";
                    trendBadge.className = "indicator-badge badge-danger";
                    trendIcon.innerHTML = '<i class="fas fa-arrow-trend-down"></i>';
                }

                // Volumen
                const volRatio = parseFloat(data.indicators.volume_ratio).toFixed(2);
                document.getElementById('vol-ratio').innerText = volRatio + 'x';
                const volStatus = document.getElementById('vol-status');
                const volBadge = document.getElementById('vol-badge');
                
                if (data.indicators.volume_confirmed) {
                    volStatus.innerText = "Alto Volumen Detectado";
                    volStatus.style.color = "var(--gold)";
                    volBadge.innerText = "ALTO";
                    volBadge.className = "indicator-badge badge-warning";
                } else {
                    volStatus.innerText = "Volumen Normal";
                    volStatus.style.color = "var(--text-secondary)";
                    volBadge.innerText = "NORMAL";
                    volBadge.className = "indicator-badge badge-neutral";
                }

                // Actualizar estado de conexi√≥n
                document.getElementById('connection-text').innerText = "Conectado";

            } catch (e) {
                console.error("Error de conexi√≥n con el servidor", e);
                document.getElementById('connection-text').innerText = "Desconectado";
            }
        }

        // Actualizar cada 3 segundos
        setInterval(fetchData, 3000);
        fetchData();
    </script>
</body>
</html>